drop database IF EXISTS hive CASCADE;
create database hive;
use hive;
CREATE TABLE SUPPLIER(S_SUPPKEY INT,S_NAME STRING,S_ADDRESS STRING,S_NATIONKEY INT,S_PHONE STRING,S_ACCTBAL DOUBLE,S_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/supplier.tbl' OVERWRITE INTO TABLE SUPPLIER;
CREATE TABLE REGION(R_REGIONKEY INT,R_NAME STRING,R_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/region.tbl' OVERWRITE INTO TABLE REGION;
CREATE TABLE PARTSUPP(PS_PARTKEY INT,PS_SUPPKEY INT,PS_AVAILQTY INT,PS_SUPPLYCOST DOUBLE,PS_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/partsupp.tbl' OVERWRITE INTO TABLE PARTSUPP;
CREATE TABLE PART(P_PARTKEY INT,P_NAME STRING,P_MFGR STRING,P_BRAND STRING,P_TYPE STRING,P_SIZE INT,P_CONTAINER STRING,P_RETAILPRICE DOUBLE,P_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/part.tbl' OVERWRITE INTO TABLE PART;
CREATE TABLE ORDERS(O_ORDERKEY INT,O_CUSTKEY INT,O_ORDERSTATUS STRING,O_TOTALPRICE DOUBLE,O_ORDERDATE DATE,O_ORDERPRIORITY STRING,O_CLERK STRING,O_SHIPPRIORITY INT,O_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/orders.tbl' OVERWRITE INTO TABLE ORDERS;
CREATE TABLE NATION(N_NATIONKEY INT,N_NAME STRING,N_REGIONKEY INT,N_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/nation.tbl' OVERWRITE INTO TABLE NATION;
CREATE TABLE LINEITEM(L_ORDERKEY INT,L_PARTKEY INT,L_SUPPKEY INT,L_LINENUMBER INT,L_QUANTITY DOUBLE,L_EXTENDEDPRICE DOUBLE,L_DISCOUNT DOUBLE,L_TAX DOUBLE,L_RETURNFLAG STRING,L_LINESTATUS STRING,L_SHIPDATE DATE,L_COMMITDATE DATE,L_RECEIPTDATE DATE,L_SHIPINSTRUCT STRING,L_SHIPMODE STRING,L_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/lineitem.tbl' OVERWRITE INTO TABLE LINEITEM;
CREATE TABLE CUSTOMER(C_CUSTKEY INT,C_NAME STRING,C_ADDRESS STRING,C_NATIONKEY INT,C_PHONE STRING,C_ACCTBAL DOUBLE,C_MKTSEGMENT STRING,C_COMMENT STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;
LOAD DATA LOCAL INPATH '/home/cherry/sotc_cloud-panthera-nist-test/plusd/tpch/customer.tbl' OVERWRITE INTO TABLE CUSTOMER;
select p_brand, p_type, p_size, count(distinct ps_suppkey) as supplier_cnt from partsupp, part where p_partkey = ps_partkey and p_brand <> 'Brand#45' and p_type not like 'MEDIUM POLISHED%' and p_size in (49, 14, 23, 45, 19, 3, 36, 9) and ps_suppkey not in ( select s_suppkey from supplier where s_comment like '%Customer%Complaints%' ) group by p_brand, p_type, p_size order by supplier_cnt desc, p_brand, p_type, p_size;
